# log 2026-02-14

last updated: 2026-02-14

## v2.0.0 strategic overhaul

### what was done

**Phase 1: trace.py rewrite (critical)**
- Removed parse_llmfiles_output(), build_dependency_graph(), analyze_imports_from_file()
- Replaced with trace_with_library() using CallTracer from llmfiles.core.import_tracer
- Added structlog suppression (WARNING level) to keep stdout clean for JSON
- Added project root detection and hub module scoring
- Kept subprocess fallback via llmfiles_wrapper.py

**Phase 2: new trace.py flags**
- --grep PATTERN: find files by content, then trace dependencies
- --since DATE: filter to recently changed files via git

**Phase 3: LSP integration guidance**
- Added "Combined Analysis with LSP" section to SKILL.md
- Added workflows 6-8 to references/workflows.md

**Phase 4: analyze.py enrichment**
- Added docstring, decorator, base class, type annotation, return type extraction
- Added AsyncFunctionDef support

**Phase 5: documentation updates**
- CLAUDE.md, README.md, docs/usage.md updated

**Phase 6: tests and finalization**
- 82 tests pass (replaced deleted function tests, added new architecture tests)
- CHANGELOG.md and version bump to 2.0.0

**Post-v2.0.0 fixes**
- Fixed compare.py normalize_graph() to handle v2.0 call_graph dict edge format ({to, module, line} instead of strings)
- Fixed compare.py to read from "call_graph" key (with "graph" fallback for backward compatibility)
- Fixed compare.py external deps comparison to handle dict format (package -> importing files)
- Added .gitignore entry for scripts/internal/log/ trace artifacts
- Added Pyright LSP documentation to README.md (light) and docs/usage.md (detailed)
- Added test_graph_diff_v2_format test for new compare format (93 tests pass)

**Best practices audit review**
- Verified all 16 audit items against current codebase: 15 DONE, 1 PARTIALLY DONE
- Fixed MINOR-6: renamed "Subagent Patterns" to "Pipeline Patterns" in SKILL.md
- Fixed plugin.json version: synced from 1.2.0 to 2.0.1
- Updated docs/claude_skills_best_practices_audit.md with Part 7 (post-implementation review) and resolution status on all items
- Updated scorecard: 46/60 (77%) -> 59/60 (98%)
- Identified new items for future consideration: agents/codebase-explorer.md uses outdated patterns, pyright as runtime dep, AGENTS.md deletion

**Post-audit cleanup (v2.0.2)**
- Deleted `agents/codebase-explorer.md` and `agents/` directory: used outdated `llmfiles` CLI invocations (not `${CLAUDE_PLUGIN_ROOT}` plugin scripts), triggers duplicated SKILL.md's "When to Use" section
- Confirmed AGENTS.md deletion is clean: CHANGELOG references are historical (v1.2.0, v1.0.2), no forward references found
- Moved pyright from `[project.dependencies]` to `[dependency-groups.dev]` in pyproject.toml: no script imports pyright, pyright-lsp plugin installs it independently
- Removed `agents/` from CLAUDE.md directory structure listing
- Updated docs/claude_skills_best_practices_audit.md Part 7 remaining items (3 of 6 resolved)
- All 93 tests pass after changes

### real-world test results

Tested against llm-dit-experiments (54 Python files):
- 54 files traced from generate.py entry point
- 5 hub modules identified with scores
- Call graph edges include line numbers
- External deps correctly classified
- 172ms total duration
